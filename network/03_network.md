# LESSON 5 네트워크 계층: 목적지에 데이터 전달하기


## 네트워크 계층의 역할

### 네트워크 간의 연결 구조
- 서로 다른 네트워크에 있는 목적지로 데이터를 전송하기 위해 필요한 계층
- 데이터 링크 계층에서는 이더넷 규칙을 기반으로 데이터 전송을 담당
- 여기서는 같은 네트워크에 있는 컴퓨터로는 데이터를 전송할 수 있지만 인터넷이나 다른 네트워크로는 데이터를 전송할 수 없음
- 네트워크 간의 통신을 가능하게 하는 것이 네트워크 계층의 역할
- 다른 네트워크로 데이터를 전송하려면 **라우터(router)** 라는 것이 필요함
- 라우터: 데이터의 목적지가 정해지면 해당 목적지까지 어떤 경로로 가는 것이 좋은지를 알려주는 기능을 함
- 이 때의 **목적지** 는 MAC주소가 아님!
  - 랜에서는 MAC 주소만으로도 통신할 수 있지만 다른 네트워크에는 데이터를 보낼 수 없음
- 다른 주소가 필요한데, 그 주소가 바로 **IP주소**
  - 어떤 네트워크의 어떤 컴퓨터인지 구분할 수 있도록 하는 주소
  - 이게 있으면 다른 네트워크에 있는 목적지를 지정할 수 있음
- 어떤 경로로 보낼지도 결정해야 하는데 이를 **라우팅(routing)** 이라고 함
  - 이를 위해서는 라우터가 있어야 함
  - 그리고 이 라우터에는 라우팅 테이블(routing table)이 있어서 경로 정보를 등록하고 관리함

### IP란?
- 네트워크 계층에는 IP(Internet Protocol)라는 프로토콜이 있음
- 라우터가 기능할 수 있는건 이 IP가 있어서 가능한 것 (TCP/IP의 그 IP)
- 네트워크 계층에서 캡슐화할 때는 IP헤더를 붙임
![image](https://user-images.githubusercontent.com/87118337/147853724-1bd20e06-7db2-451c-b889-ffb614b4e235.png)
- 여기서 출발지 IP 주소랑 목적지 IP 주소 정도 기억하면 됨
- 캡슐화할 때는 데이터에 IP 헤더가 추가되는데, 이를 **IP패킷** 이라고 함
  - 데이터 링크 계층에서는 프레임이라고 했었음!
  
## IP 주소의 구조
- IP 주소는 인터넷 서비스 제공자(ISP)에게 받을 수 있음
- IP 버전에는 **IPv4**, **IPv6**가 있음
  - IPv4: 32비트 > 약 43억개의 주소 만들수 있음 > 인터넷 보급에 따라 부족해짐
  - IPv6: 부족해져서 나온것 128비트 > 340간개의 주소 만들 수 ㄷ있음 (거의 무한대)
  - IPv4 주소가 고갈되고 있어서 
  - 공인 IP 주소: 인터넷 서비스 제공자(ISP)가 제공하는 주소, 인터넷에 직접 연결되는 컴퓨터나 라우터에만 할당
  - 사설 IP 주소: 회사나 가정의 랜에 있는 컴퓨터에 할당
- 랜 안에 컴퓨터가 여러대 있다면 공인 IP 주소는 사용할 수 있는 숫자가 제한 > 컴퓨터 한 대당 공인 IP 주소를 하나씩 할당하기 어려움
- 라우터에만 공인 IP를 할당 하고 다른 컴퓨터들은 랜의 네트워크 관리자가 자유롭게 사설 IP 주소를 할당하거나 라우터의 DHCP(Dynamic Host Configuration Protocol, IP주소를 자동으로 할당하는 프로토콜) 기능으로 할당해줌
- 그러면 공인 IP 주소 1개로 랜 안의 컴퓨터 여러대에 인터넷을 모두 연결 할 수 있음!

![image](https://user-images.githubusercontent.com/87118337/147854595-631fe9b5-d88a-4a25-9530-b22450ef28f2.png)

- IP주소는 32비트고 읽기 쉽게 8비트 단위로 나눠서 10진수로 변환해서 표시(8비트=옥텟(octet)이라고 부르기도 함)
![image](https://user-images.githubusercontent.com/87118337/147855007-8b621fd6-09b0-4407-8236-719812737bc2.png)

![image](https://user-images.githubusercontent.com/87118337/147855043-f880347b-a3ef-48f5-9e95-ff6c285ff7bc.png)
- 10진수로 표시하지만 실제로는 2진수로 되어있고, 4개의 옥텟으로 구분하고 있음
- 이 옥텟은 00000000 ~ 11111111 범위기 때문에 10진수로 치면 0부터 255까지의 범위를 가진다
- 또한 네트워크 ID와 호스트 ID로 나눠져 있음
  - 네트워크 ID: 어떤 네트워크인지 나타냄
  - 호스트 ID: 해당 네트워크의 어느 컴퓨터인지를 나타냄

## IP 주소의 클래스 구조
- IPv4의 주소는 32비트 > 네트워크 ID를 크게 만들거나 호스트 ID를 작게 만들어서 네트워크 크기를 조정 > 네트워크 크기는 클래스라는 개념으로 구분
  - A클래스: 대규모 네트워크 주소
    - 8비트 : 네트워크 ID / 24비트: 호스트 ID
  - B클래스: 중형 네트워크 주소
    - 16비트: 네트워크 ID / 16비트: 호스트 ID
  - C클래스: 소규모 네트워크 주소
    - 24비트: 네트워크 ID / 8비트: 호스트 ID
  - D클래스: 멀티캐스트 주소
  - E클래스: 연구 및 특수 용도 주소
- 일반 네트워크에서는 A~C클래스까지 사용

### 공인 IP 주소와 사설 IP 주소를 포함한 클래스의 범위
- A클래스
  - 네트워크 ID(8비트): 00000001~01111111 > 1~127
  - 호스트 ID(24비트): 0000000~11111111 > 0~255가 4개
  - 즉, 1.0.0.0 ~ 127.255.255.255
  - 사설 IP 주소 범위: 10.0.0.0~10.255.255.255
- B클래스
  - 네트워크 ID(16비트): 10000000~10111111, 00000000~11111111 > 128~191, 0~255
  - 호스트 ID(16비트): 00000000~11111111 > 0~255
  - 즉, 128.0.0.0.0 ~ 191.255.255.255
  - 사설 IP 주소 범위: 172.16.0.0~172.31.255.255
- C클래스
  - 네트워크 ID(24비트): 11000000~11011111, 00000000~11111111 2개 > 192~223, 0~255
  - 호스트 ID(8비트): 00000000~11111111 > 0~255
  - 즉, 192.0.0.0.0 ~ 223.255.255.255
  - 사설 IP 주소 범위: 192.168.255.255
- **사설 IP 주소는 절대 공인 IP 주소로 사용할 수 없음!**
- IP 주소 확인은 cmd에서 ipconfig로 확인 가능

## 네트워크 주소와 브로드캐스트 주소의 구조
![image](https://user-images.githubusercontent.com/87118337/147855755-2fff5a4a-ce37-4d11-ab8c-1f319afa04a3.png)
- IP 주소에는 네트워크 주소와 브로드캐스트 주소가 있는데, 이 두 주소는 특별한 주소로 컴퓨터나 라우터가 자신의 IP로 사용하면 안되는 주소
  - 네트워크 주소: 호스트 ID가 10진수로 0, 2진수로는 00000000인 주소
    - ![image](https://user-images.githubusercontent.com/87118337/147855781-a25581a9-a776-4de8-8003-99ad19003ce9.png)
    - 전체 네트워크에서 작은 네트워크를 식별하는데 사용 > 네트워크의 대표 주소
  - 브로드캐스트 주소: 호스트 ID가 10진수로 255, 2진수로는 11111111인 주소
    - ![image](https://user-images.githubusercontent.com/87118337/147855831-e38b73c9-2453-4779-89d3-e33e4a11d75a.png)
    - 네트워크에 있는 컴퓨터나 장비 모두에게 한번에 데이터를 전송하는데 사용되는 전용 IP 주소
- **네트워크 주소와 브로드캐스트 주소는 자신의 IP 주소로 설정하면 절대 안된다**

## 서브넷의 구조
- 많은 수의 컴퓨터가 브로드캐스트 패킷을 전송하면 모든 컴퓨터에 전송이 되고 네트워크가 혼잡해짐 > A클래스의 대규모 네트워크를 작은 네트워크로 분할 후, 브로드캐스트로 전송되는 패킷의 범위를 좁힘
- 이렇게 하면 더 많은 네트워크를 만들 수 있어서 IP 주소를 더 효과적으로 활용할 수 있음
- 이렇게 분할하는 것을 **서브넷팅(subneting)** 이라고 하고, 분할된 네트워크를 **서브넷(subnet)** 이라고 함!!
![image](https://user-images.githubusercontent.com/87118337/147856096-23d73d84-6fd2-4d70-b79b-fc375a906ea7.png)
- 서브넷팅 후에는 이렇게 호스트 ID에서 비트를 빌려서 서브넷 ID로 사용!

### 서브넷 마스크
- 서브넷 마스크: 네트워크 ID와 호스트 ID를 식별하기 위한 값
- A클래스: 255.0.0.0
- B클래스: 255.255.0.0
- C클래스: 255.255.255.0
- 프리픽스(prefix) 표기법으로 사용 가능
  - 서브넷 마스크를 슬래시(/비트수)로 나타낸 것
  - 예) 255.255.2550은 /24
- 서브넷팅 예)
  - C클래스
  - ![image](https://user-images.githubusercontent.com/87118337/147856310-0bb8f69d-d2cc-41c5-85af-4fb9fdb214fe.png)
  - 서브넷팅 하기 전
    - 네트워크 ID가 24비트
  - ![image](https://user-images.githubusercontent.com/87118337/147856333-4b3af60c-5415-43db-9b58-5a4319f1dce0.png)
  - 서브넷팅 후
    - 네트워크 ID를 28비트를 변경하고 4비트를 호스트 ID에서 빌림
    - 네트워크 ID 24비트, 서브넷 ID 4비트, 호스트 ID 4비트
    - 서브넷 마스크: 255.255.255.240 > 프리픽스 표기법 /28 (=28비트, 네트워크 ID + 서브넷 ID)

## 라우터의 구조
![image](https://user-images.githubusercontent.com/87118337/147856425-1b82e5d7-d58d-479d-8d9e-de3d8aeb19a1.png)
- 라우터는 네트워크를 분리할 수 있음
- 서로 다른 네트워크와 통신할 때 필요
![image](https://user-images.githubusercontent.com/87118337/147856429-07db6a80-74db-4fde-8c64-aa1fb6da0282.png)
- 스위치를 사용하게 되면 동일한 네트워크에 속하게 됨
- 네트워크를 분할할 수 없음

### 분할 후 다른 네트워크로 접속하려면
![image](https://user-images.githubusercontent.com/87118337/147856480-4a600c3d-383d-496c-8942-8cdb054d6703.png)
- 라우터의 IP 주소를 설정해야 함
- 네트워크의 출입구를 설정하는 것으로 이것을 **기본 게이트웨이(default gateway)** 라고 함
- 예) 컴퓨터1은 192.168.0.1/24 네트워크에 속해있기 때문에 라우터의 IP 주소인 198.168.1.1로 설정됨
- 윈도우에서 자동으로 IP 주소 받기가 체크되어 있어서 기본 게이트웨이가 자동으로 설정 됨

- 여기에 추가로 라우터의 라우팅 기능이 필요함

### 라우팅이란?
![image](https://user-images.githubusercontent.com/87118337/147856584-90aacf00-a624-44f4-b8f2-3de252279ea9.png)
- 라우팅: 경로 정보를 기반으로 현재의 네트워크에서 다른 네트워크로의 최적을 통해 데이터를 전송
- 이 경로 정보가 등록되어 있는 테이블이 **라우팅 테이블**
- 이렇게 각 라우터의 라우팅 테이블에 경로정보가 등록되어 있어서 라우팅이 가능
- 즉, A컴퓨터에서 B컴퓨터로 데이터를 보낼 수 있음
- 등록하는 방법
  - 소규모 네트워크: 수동 등록
  - 대규모 네트워크: 자동 등록
- 라우팅 프로토콜: 라우터 간에 라우팅 정보를 교환하기 위한 프로토콜
  - 얘를 설정해서 라우터 간에 경로 정보를 서로 교환, 라우팅 테이블에 등록해나감
  - 종류: RIP, OSPF, BGP 등이 있음


# LESSON 6 전송 계층: 신뢰할 수 있는 데이터 전송하기

## 전송 계층의 역할

## TCP의 구조

## 일련번호와 확인 응답 번호의 구조로

## 포트 번호의 구조

## UDP의 구조
